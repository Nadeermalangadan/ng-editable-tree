!function(a){"use strict";a.widget("mjs.nestedSortable",a.extend({},a.ui.sortable.prototype,{options:{tabSize:20,disableNesting:"mjs-nestedSortable-no-nesting",errorClass:"mjs-nestedSortable-error",doNotClear:!1,listType:"ol",maxLevels:0,protectRoot:!1,rootID:null,rtl:!1,isAllowed:function(){return!0}},_create:function(){if(this.element.data("sortable",this.element.data("nestedSortable")),!this.element.is(this.options.listType))throw new Error("nestedSortable: Please check the listType option is set to your actual list type");return a.ui.sortable.prototype._create.apply(this,arguments)},destroy:function(){return this.element.removeData("nestedSortable").unbind(".nestedSortable"),a.ui.sortable.prototype.destroy.apply(this,arguments)},_mouseDrag:function(b){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);var c=this.options;if(this.options.scroll){var d=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute");var e=this.placeholder.offset().top;this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var f=this.items.length-1;f>=0;f--){var g=this.items[f],h=g.item[0],i=this._intersectsWithPointer(g);if(i&&h!=this.currentItem[0]&&this.placeholder[1==i?"next":"prev"]()[0]!=h&&!a.contains(this.placeholder[0],h)&&("semi-dynamic"==this.options.type?!a.contains(this.element[0],h):!0)){if(a(h).mouseenter(),this.direction=1==i?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(g))break;a(h).mouseleave(),this._rearrange(b,g),this._clearEmpty(h),this._trigger("change",b,this._uiHash());break}}var j=this.placeholder[0].parentNode.parentNode&&a(this.placeholder[0].parentNode.parentNode).closest(".ui-sortable").length?a(this.placeholder[0].parentNode.parentNode):null,k=this._getLevel(this.placeholder),l=this._getChildLevels(this.helper),m=this.placeholder[0].previousSibling?a(this.placeholder[0].previousSibling):null;if(null!=m)for(;"li"!=m[0].nodeName.toLowerCase()||m[0]==this.currentItem[0]||m[0]==this.helper[0];){if(!m[0].previousSibling){m=null;break}m=a(m[0].previousSibling)}var n=this.placeholder[0].nextSibling?a(this.placeholder[0].nextSibling):null;if(null!=n)for(;"li"!=n[0].nodeName.toLowerCase()||n[0]==this.currentItem[0]||n[0]==this.helper[0];){if(!n[0].nextSibling){n=null;break}n=a(n[0].nextSibling)}var o=document.createElement(c.listType);return this.beyondMaxLevels=0,null!=j&&null==n&&(c.rtl&&this.positionAbs.left+this.helper.outerWidth()>j.offset().left+j.outerWidth()||!c.rtl&&this.positionAbs.left<j.offset().left)?(j.after(this.placeholder[0]),this._clearEmpty(j[0]),this._trigger("change",b,this._uiHash())):null!=m&&(c.rtl&&this.positionAbs.left+this.helper.outerWidth()<m.offset().left+m.outerWidth()-c.tabSize||!c.rtl&&this.positionAbs.left>m.offset().left+c.tabSize)?(this._isAllowed(m,k,k+l+1),m.children(c.listType).length||m[0].appendChild(o),e&&e<=m.offset().top?m.children(c.listType).prepend(this.placeholder):m.children(c.listType)[0].appendChild(this.placeholder[0]),this._trigger("change",b,this._uiHash())):this._isAllowed(j,k,k+l),this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b){this.beyondMaxLevels&&(this.placeholder.removeClass(this.options.errorClass),this.domPosition.prev?a(this.domPosition.prev).after(this.placeholder):a(this.domPosition.parent).prepend(this.placeholder),this._trigger("revert",b,this._uiHash()));for(var c=this.items.length-1;c>=0;c--){var d=this.items[c].item[0];this._clearEmpty(d)}a.ui.sortable.prototype._mouseStop.apply(this,arguments)},serialize:function(b){var c=a.extend({},this.options,b),d=this._getItemsAsjQuery(c&&c.connected),e=[];return a(d).each(function(){var b=(a(c.item||this).attr(c.attribute||"id")||"").match(c.expression||/(.+)[-=_](.+)/),d=(a(c.item||this).parent(c.listType).parent(c.items).attr(c.attribute||"id")||"").match(c.expression||/(.+)[-=_](.+)/);b&&e.push((c.key||b[1])+"["+(c.key&&c.expression?b[1]:b[2])+"]"+"="+(d?c.key&&c.expression?d[1]:d[2]:c.rootID))}),!e.length&&c.key&&e.push(c.key+"="),e.join("&")},toHierarchy:function(b){function c(b){var e=(a(b).attr(d.attribute||"id")||"").match(d.expression||/(.+)[-=_](.+)/);if(e){var f={id:e[2]};return a(b).children(d.listType).children(d.items).length>0&&(f.children=[],a(b).children(d.listType).children(d.items).each(function(){var a=c(this);f.children.push(a)})),f}}var d=a.extend({},this.options,b),e=(d.startDepthCount||0,[]);return a(this.element).children(d.items).each(function(){var a=c(this);e.push(a)}),e},toArray:function(b){function c(b,g,h){var i,j,k=h+1;if(a(b).children(d.listType).children(d.items).length>0&&(g++,a(b).children(d.listType).children(d.items).each(function(){k=c(a(this),g,k)}),g--),i=a(b).attr(d.attribute||"id").match(d.expression||/(.+)[-=_](.+)/),g===e+1)j=d.rootID;else{var l=a(b).parent(d.listType).parent(d.items).attr(d.attribute||"id").match(d.expression||/(.+)[-=_](.+)/);j=l[2]}return i&&f.push({item_id:i[2],parent_id:j,depth:g,left:h,right:k}),h=k+1}var d=a.extend({},this.options,b),e=d.startDepthCount||0,f=[],g=2;return f.push({item_id:d.rootID,parent_id:"none",depth:e,left:"1",right:2*(a(d.items,this.element).length+1)}),a(this.element).children(d.items).each(function(){g=c(this,e+1,g)}),f=f.sort(function(a,b){return a.left-b.left})},_clearEmpty:function(b){var c=a(b).children(this.options.listType);!c.length||c.children().length||this.options.doNotClear||c.remove()},_getLevel:function(a){var b=1;if(this.options.listType)for(var c=a.closest(this.options.listType);c&&c.length>0&&!c.is(".ui-sortable");)b++,c=c.parent().closest(this.options.listType);return b},_getChildLevels:function(b,c){var d=this,e=this.options,f=0;return c=c||0,a(b).children(e.listType).children(e.items).each(function(a,b){f=Math.max(d._getChildLevels(b,c+1),f)}),c?f+1:f},_isAllowed:function(b,c,d){var e=this.options,f=a(this.domPosition.parent).hasClass("ui-sortable")?!0:!1,g=this.placeholder.closest(".ui-sortable").nestedSortable("option","maxLevels");!e.isAllowed(this.currentItem,b)||b&&b.hasClass(e.disableNesting)||e.protectRoot&&(null==b&&!f||f&&c>1)?(this.placeholder.addClass(e.errorClass),this.beyondMaxLevels=d>g&&0!=g?d-g:1):d>g&&0!=g?(this.placeholder.addClass(e.errorClass),this.beyondMaxLevels=d-g):(this.placeholder.removeClass(e.errorClass),this.beyondMaxLevels=0)}})),a.mjs.nestedSortable.prototype.options=a.extend({},a.ui.sortable.prototype.options,a.mjs.nestedSortable.prototype.options)}(jQuery),define("ng-editable-tree",[],function(){"use strict";angular.module("ngEditableTree",["ngResource"]).directive("treeView",function(){return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,compile:function(a,b,c){var d,e,f,g,h;return d=b.treeView.match(/^(.*) in ((?:.*\.)?(.*)) at (.*)$/),e=d[1],f=d[2],g=d[3],h=d[4],function(a,b){function d(a){for(var b=j.length;b--;)if(j[b].scope[e]===a)return j.splice(b,1)[0]}var i=b[0].parentNode,j=[];a.$watch(f,function(b){var f=[];!function m(a,b,i,k){for(var l,n,o,p,q,r=0,s=a?a.length:0,t=s-1;s>r;++r)l=b.childNodes[r],n=a[r],o=d(n),o&&o.parentScope!==i&&(j.push(o),o=null),o?o.element!==l&&b.insertBefore(o.element,l):c(i.$new(),function(a,c){c[e]=n,o={scope:c,parentScope:i,element:a[0],branch:a.find(h)[0]},b.insertBefore(o.element,l)}),p=o.scope,p.$depth=k,p.$index=r,p.$first=0===r,p.$last=r===t,p.$middle=!(p.$first||p.$last),f.push(o),q=n[g],q&&q.length&&m(q,o.branch,p,k+1)}(b,i,a,0);for(var k=j.length;k--;){var l=j[k];l.scope&&l.scope.$destroy(),l.element&&l.element.parentNode.removeChild(l.element)}j=f},!0)}}}}).directive("treeViewSortable",["$parse",function(a){var b="Create Start Sort Change BeforeStop Update Receive Remove Over Out Activate Deactivate".split(" ");return{restrict:"A",link:function(c,d,e){var f={listType:"ol",items:"li",doNotClear:!0,handle:".title-item-menu",placeholder:"nav-placeholder",forcePlaceholderSize:!0,maxLevels:5,toleranceElement:"> div"},g=e.treeViewSortableOptions?a(e.treeViewSortableOptions)():{};f=angular.extend(f,g);var h=a(e.treeViewSortable)(c);c.$watch(e.treeViewSortable,function(a){h=a}),f.sort=function(a,b){var c=$(b.placeholder).parents("li.ng-scope",".nav-nested");$.each(c,function(a,b){var c=angular.element(b),d=c.scope(),e=$(b).attr("tree-view").match(/^(.*) in ((?:.*\.)?(.*)) at (.*)$/);d.$apply(function(){d[e[1]].$expanded=!0})})},f.stop=function(b,d){function f(a,b){var c,d=a.children;if(d)for(c=d.length;c--;){if(d[c]===b)return d.splice(c,1);f(d[c],b)}}var g=b.target,i=d.item,j=i.parent(),k=j[0]===g?h:j.scope().child,l=i.scope().child,m=i.index();k.children||(k.children=[]),f(h,l),k.children.splice(m,0,l);var n=a(e.treeViewMove);c.$apply(function(){n(c,{$item:l,$before:m?k.children[m-1]:k,$index:m})})},angular.forEach(b,function(b){var d,g=e["treeViewSortable"+b];g&&(d=a(g),f[b.charAt(0).toLowerCase()+b.substr(1)]=function(a,b){c.$apply(function(){d(c,{$event:a,$ui:b})})})}),d.nestedSortable(f)}}}]).factory("ngNestedResource",["$resource","$q","$rootScope",function(a,b,c){function d(d,e,f,g){function h(a,b){b=b||null;for(var c=0,d=a.length;d>c;c++)a[c][g.nestedField]||(a[c][g.nestedField]=[]),a[c]instanceof j||(a[c]=new j(a[c])),a[c][g.nestedField].length&&h(a[c][g.nestedField],a[c])}var i={update:{method:"POST"},create:{method:"PUT",params:{insert:!0}},move:{method:"PUT",params:{move:!0}}};f=angular.extend(i,f),g=angular.extend({nestedField:"children"},g);var j=a(d,e,f);j.prototype.$insertItem=function(a){a=a||angular.noop;var b=this,d=angular.copy(this);return d.$create({id:b.id},function(d){d[g.nestedField]=[],b.$expanded=!0,b[g.nestedField].unshift(d),c.$$phase||c.$apply(),a(d)})},j.prototype.$moveItem=function(a,b,c){c=c||angular.noop;var d=new j(this);return d.$move({id:this.id,insert:0==b,before:a.id},function(a){c(a)})},j.getTree=function(a,c){c=c||angular.noop,"function"==typeof a&&(c=a,a={});var d=b.defer();return j.get(a,function(a){h(a[g.nestedField]),d.resolve(a),c(a)}),d.promise};var k=function(a,b,c){if(c=c||[],angular.isUndefined(a))return null;if(b.call(this,a))return a;for(var d=null,e=0,f=a[g.nestedField].length;f>e;e++)if(d=k(a[g.nestedField][e],b,c)){c.push(a[g.nestedField][e]);break}return d};return j.find=function(a,b,c){return k(a,b,c)},j}return d}])});
/*
//@ sourceMappingURL=ng-editable-tree.min.map
*/